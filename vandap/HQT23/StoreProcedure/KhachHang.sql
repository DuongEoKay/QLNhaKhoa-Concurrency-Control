use NHAKHOA
go 
 
 CREATE OR ALTER PROC SP_INSERT_KHACHHANG
	@IDKHACHHANG VARCHAR(5) = NULL,
    @HOTEN NVARCHAR(30),
    @SDT VARCHAR(11),
	@NGAYSINH DATE,
    @MATKHAU VARCHAR(20)
AS BEGIN TRAN
	IF EXISTS (SELECT * FROM KHACHHANG WHERE SDT = @SDT) 
	BEGIN
        RAISERROR('Khach hang da ton tai', 16, 1)
        ROLLBACK TRAN
        RETURN -1
    END

    SELECT @IDKHACHHANG = IDKHACHHANG FROM KHACHHANG
    WHERE IDKHACHHANG = (SELECT MAX(IDKHACHHANG) FROM KHACHHANG)

    SET @IDKHACHHANG = dbo.F_GenerateID('KH', @IDKHACHHANG)

    INSERT INTO KHACHHANG
    VALUES (@IDKHACHHANG, @HOTEN, @SDT, @NGAYSINH, @MATKHAU)
COMMIT TRAN
RETURN 0
GO

EXEC SP_INSERT_KHACHHANG
 null, N'Bùi Ngọc Tiến',  '04215478651', '1990/11/11', '123'
 EXEC SP_INSERT_KHACHHANG
 null, N'Vương Thịnh Đoàn',  '03506027378', '2003/1/4', '123'
 EXEC SP_INSERT_KHACHHANG
 null, N'Nguyễn Uyên Huỳnh',  '07801199141', '1988/10/15', '123'
 EXEC SP_INSERT_KHACHHANG
 null, N'Võ Trang Trần',  '07692144174', '1975/9/24', '123'
 EXEC SP_INSERT_KHACHHANG
 null, N'Huỳnh Quốc Thế',  '05668349716', '1955/8/30', '123'
 EXEC SP_INSERT_KHACHHANG
 null, N'Trần Hương Song',  '03209060001', '1999/7/12', '123'

 select * from KhachHang
 --delete from KhachHang