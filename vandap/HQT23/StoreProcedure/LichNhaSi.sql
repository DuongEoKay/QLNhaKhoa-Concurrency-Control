use NHAKHOA
go

CREATE OR ALTER PROC SP_INSERT_LICHNHASI
	@IDNHASI VARCHAR(5),
	@THOIGIANTRONG DATE
AS BEGIN TRAN


	IF NOT EXISTS (SELECT * FROM NhanSu WHERE IDNhanSu = @IDNHASI) 
	BEGIN
        RAISERROR('NHA SI KHONG TON TAI', 16, 1)
        ROLLBACK TRAN
        RETURN -1
    END

	IF DATEDIFF(d, @THOIGIANTRONG, GETDATE()) > 0
	BEGIN
        RAISERROR('THOI GIAN KHONG HOP LE', 16, 1)
        ROLLBACK TRAN
        RETURN -1
    END

    INSERT INTO LichNhaSi
    VALUES (@IDNHASI, @THOIGIANTRONG)
COMMIT TRAN
RETURN 0
GO

EXEC SP_INSERT_LICHNHASI
 'NS01', '2024/12/22'
EXEC SP_INSERT_LICHNHASI
 'NS01', '2024/10/09'
 EXEC SP_INSERT_LICHNHASI
 'NS02', '2024/11/15'
 EXEC SP_INSERT_LICHNHASI
 'NS02', '2024/11/16'
 EXEC SP_INSERT_LICHNHASI
 'NS02', '2024/11/17'
  EXEC SP_INSERT_LICHNHASI
 'NS02', '2024/11/18'
  EXEC SP_INSERT_LICHNHASI
 'NS03', '2024/09/25'
   EXEC SP_INSERT_LICHNHASI
 'NS03', '2024/09/28'
   EXEC SP_INSERT_LICHNHASI
 'NS03', '2024/09/21'
 EXEC SP_INSERT_LICHNHASI
 'NS03', '2024/09/24'

 select * from LichNhaSi
 --delete from LichNhaSi 
 --WHERE IDNhaSi = 'NS03' AND ThoiGianTrong = '2024/09/20'